{"plugins":{"serverless-post-function":{"type":"object","properties":{"phase":{"type":"string","enum":["rewrite","access","header_filter","body_filter","log","balancer"]},"functions":{"type":"array","items":{"type":"string"},"minItems":1}},"required":["functions"]},"prometheus":{"type":"object","additionalProperties":false},"syslog":{"type":"object","properties":{"port":{"type":"integer"},"flush_limit":{"type":"integer","default":4096,"minimum":1},"name":{"type":"string","default":"sys logger"},"sock_type":{"type":"string","default":"tcp"},"drop_limit":{"type":"integer","default":1048576},"include_req_body":{"type":"boolean","default":false},"buffer_duration":{"type":"integer","default":60,"minimum":1},"timeout":{"type":"integer","default":3,"minimum":1},"retry_interval":{"type":"integer","default":1,"minimum":0},"batch_max_size":{"type":"integer","default":1000,"minimum":1},"pool_size":{"type":"integer","default":5,"minimum":5},"max_retry_times":{"type":"integer","default":1,"minimum":1},"tls":{"type":"boolean","default":false},"host":{"type":"string"}},"required":["host","port"]},"udp-logger":{"type":"object","properties":{"inactive_timeout":{"type":"integer","default":5,"minimum":1},"port":{"type":"integer","minimum":0},"include_req_body":{"type":"boolean","default":false},"name":{"type":"string","default":"udp logger"},"batch_max_size":{"type":"integer","default":1000,"minimum":1},"timeout":{"type":"integer","default":3,"minimum":1},"buffer_duration":{"type":"integer","default":60,"minimum":1},"host":{"type":"string"}},"required":["host","port"]},"basic-auth":{"type":"object","oneOf":[{"title":"work with route or service object","properties":{"password":{"type":"string"},"username":{"type":"string"}},"additionalProperties":false,"required":["username","password"]},{"title":"work with consumer object","properties":[],"additionalProperties":false}]},"ip-restriction":{"type":"object","oneOf":[{"title":"whitelist","properties":{"whitelist":{"type":"array","items":{"anyOf":[{"title":"IPv4","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}$","type":"string"},{"title":"IPv4/CIDR","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/[0-9]{1,2}$","type":"string"},{"title":"IPv6","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?$","type":"string"},{"title":"IPv6/CIDR","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?/[0-9]{1,3}$","type":"string"}]},"minItems":1}},"additionalProperties":false,"required":["whitelist"]},{"title":"blacklist","properties":{"blacklist":{"type":"array","items":{"anyOf":[{"title":"IPv4","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}$","type":"string"},{"title":"IPv4/CIDR","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/[0-9]{1,2}$","type":"string"},{"title":"IPv6","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?$","type":"string"},{"title":"IPv6/CIDR","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?/[0-9]{1,3}$","type":"string"}]},"minItems":1}},"additionalProperties":false,"required":["blacklist"]}]},"fault-injection":{"type":"object","properties":{"delay":{"type":"object","properties":{"duration":{"type":"number","minimum":0}},"minProperties":1},"abort":{"type":"object","properties":{"http_status":{"type":"integer","minimum":200},"body":{"type":"string","minLength":0}},"minProperties":1}},"minProperties":1},"grpc-transcode":{"type":"object","properties":{"proto_id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"deadline":{"description":"deadline for grpc, millisecond","default":0,"type":"number"},"service":{"description":"the grpc service name","type":"string"},"pb_option":{"type":"array","items":{"type":"string","anyOf":[{"description":"enum as result","enum":["int64_as_number","int64_as_string","int64_as_hexstring"],"type":"string"},{"description":"int64 as result","enum":["ienum_as_name","enum_as_value"],"type":"string"},{"description":"default values option","enum":["auto_default_values","no_default_values","use_default_values","use_default_metatable"],"type":"string"},{"description":"hooks option","enum":["enable_hooks","disable_hooks"],"type":"string"}]},"minItems":1},"method":{"description":"the method name in the grpc service.","type":"string"}},"additionalProperties":true,"required":["proto_id","service","method"]},"skywalking":{"type":"object","properties":{"endpoint":{"type":"string"},"sample_ratio":{"type":"number","default":1,"maximum":1,"minimum":1e-05}},"service_name":{"type":"string","default":"APISIX","description":"service name for skywalking"},"required":["endpoint"]},"request-id":{"type":"object","properties":{"header_name":{"type":"string","default":"X-Request-Id"},"include_in_response":{"type":"boolean","default":true}}},"cors":{"type":"object","properties":{"allow_methods":{"description":"you can use '*' to allow all methods when no credentials and '**','**' to allow forcefully(it will bring some security risks, be carefully),multiple method use ',' to split. default: *.","default":"*","type":"string"},"expose_headers":{"description":"you can use '*' to expose all header when no credentials,multiple header use ',' to split. default: *.","default":"*","type":"string"},"allow_origins":{"description":"you can use '*' to allow all origins when no credentials,'**' to allow forcefully(it will bring some security risks, be carefully),multiple origin use ',' to split. default: *.","default":"*","type":"string"},"allow_headers":{"description":"you can use '*' to allow all header when no credentials,'**' to allow forcefully(it will bring some security risks, be carefully),multiple header use ',' to split. default: *.","default":"*","type":"string"},"allow_credential":{"description":"allow client append crendential. according to CORS specification,if you set this option to 'true', you can not use '*' for other options.","default":false,"type":"boolean"},"max_age":{"description":"maximum number of seconds the results can be cached.-1 mean no cached,the max value is depend on browser,more detail plz check MDN. default: 5.","default":5,"type":"integer"}}},"kafka-logger":{"type":"object","properties":{"inactive_timeout":{"type":"integer","default":5,"minimum":1},"broker_list":{"type":"object"},"key":{"type":"string"},"include_req_body":{"type":"boolean","default":false},"kafka_topic":{"type":"string"},"timeout":{"type":"integer","default":3,"minimum":1},"batch_max_size":{"type":"integer","default":1000,"minimum":1},"max_retry_count":{"type":"integer","default":0,"minimum":0},"retry_delay":{"type":"integer","default":1,"minimum":0},"buffer_duration":{"type":"integer","default":60,"minimum":1},"name":{"type":"string","default":"kafka logger"}},"required":["broker_list","kafka_topic","key"]},"openid-connect":{"type":"object","properties":{"realm":{"type":"string"},"scope":{"type":"string"},"ssl_verify":{"type":"boolean"},"public_key":{"type":"string"},"client_id":{"type":"string"},"redirect_uri":{"type":"string"},"timeout":{"type":"integer","minimum":1},"discovery":{"type":"string"},"bearer_only":{"type":"boolean"},"introspection_endpoint_auth_method":{"type":"string"},"introspection_endpoint":{"type":"string"},"logout_path":{"type":"string"},"client_secret":{"type":"string"},"token_signing_alg_values_expected":{"type":"string"}},"required":["client_id","client_secret","discovery"]},"http-logger":{"type":"object","properties":{"inactive_timeout":{"type":"integer","default":5,"minimum":1},"name":{"type":"string","default":"http logger"},"auth_header":{"type":"string","default":""},"concat_method":{"type":"string","default":"json","enum":["json","new_line"]},"include_req_body":{"type":"boolean","default":false},"timeout":{"type":"integer","default":3,"minimum":1},"batch_max_size":{"type":"integer","default":1000,"minimum":1},"max_retry_count":{"type":"integer","default":0,"minimum":0},"retry_delay":{"type":"integer","default":1,"minimum":0},"buffer_duration":{"type":"integer","default":60,"minimum":1},"uri":{"type":"string"}},"required":["uri"]},"batch-requests":{"type":"object","additionalProperties":false},"request-validation":{"type":"object","properties":{"header_schema":{"type":"object"},"body_schema":{"type":"object"}},"anyOf":[{"required":["body_schema"]},{"required":["header_schema"]}]},"proxy-rewrite":{"type":"object","properties":{"headers":{"description":"new headers for request","minProperties":1,"type":"object"},"host":{"description":"new host for upstream","pattern":"^[0-9a-zA-Z-.]+$","type":"string"},"regex_uri":{"description":"new uri that substitute from client uri for upstream, lower priority than uri property","maxItems":2,"type":"array","items":{"description":"regex uri","type":"string"},"minItems":2},"scheme":{"description":"new scheme for upstream","enum":["http","https"],"type":"string"},"uri":{"description":"new uri for upstream","pattern":"^\\/.*","minLength":1,"maxLength":4096,"type":"string"}},"minProperties":1,"additionalProperties":false},"tcp-logger":{"type":"object","properties":{"inactive_timeout":{"type":"integer","default":5,"minimum":1},"port":{"type":"integer","minimum":0},"name":{"type":"string","default":"tcp logger"},"include_req_body":{"type":"boolean","default":false},"batch_max_size":{"type":"integer","default":1000,"minimum":1},"timeout":{"type":"integer","default":1000,"minimum":1},"tls_options":{"type":"string"},"buffer_duration":{"type":"integer","default":60,"minimum":1},"max_retry_count":{"type":"integer","default":0,"minimum":0},"retry_delay":{"type":"integer","default":1,"minimum":0},"tls":{"type":"boolean","default":false},"host":{"type":"string"}},"required":["host","port"]},"zipkin":{"type":"object","properties":{"endpoint":{"type":"string"},"server_addr":{"type":"string","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}$","description":"default is $server_addr, you can speific your external ip address"},"service_name":{"type":"string","default":"APISIX","description":"service name for zipkin reporter"},"sample_ratio":{"type":"number","maximum":1,"minimum":1e-05}},"required":["endpoint","sample_ratio"]},"uri-blocker":{"type":"object","properties":{"rejected_code":{"type":"integer","default":403,"minimum":200},"block_rules":{"type":"array","uniqueItems":true,"items":{"type":"string","maxLength":4096,"minLength":1}}},"required":["block_rules"]},"wolf-rbac":{"type":"object","properties":{"appid":{"type":"string","default":"unset"},"server":{"type":"string","default":"http://127.0.0.1:10080"},"header_prefix":{"type":"string","default":"X-"}}},"authz-keycloak":{"type":"object","properties":{"grant_type":{"type":"string","enum":["urn:ietf:params:oauth:grant-type:uma-ticket"],"minLength":1,"maxLength":100,"default":"urn:ietf:params:oauth:grant-type:uma-ticket"},"audience":{"type":"string","maxLength":100,"minLength":1},"ssl_verify":{"type":"boolean","default":true},"keepalive":{"type":"boolean","default":true},"policy_enforcement_mode":{"type":"string","enum":["ENFORCING","PERMISSIVE"],"default":"ENFORCING"},"permissions":{"type":"array","uniqueItems":true,"items":{"type":"string","maxLength":100,"minLength":1}},"timeout":{"type":"integer","default":3000,"minimum":1000},"token_endpoint":{"type":"string","maxLength":4096,"minLength":1},"keepalive_timeout":{"type":"integer","default":60000,"minimum":1000},"keepalive_pool":{"type":"integer","default":5,"minimum":1}},"required":["token_endpoint"]},"serverless-pre-function":{"type":"object","properties":{"phase":{"type":"string","enum":["rewrite","access","header_filter","body_filter","log","balancer"]},"functions":{"type":"array","items":{"type":"string"},"minItems":1}},"required":["functions"]},"example-plugin":{"type":"object","properties":{"s":{"type":"string"},"port":{"type":"integer"},"t":{"type":"array","minItems":1},"ip":{"type":"string"},"i":{"type":"number","minimum":0}},"required":["i"]},"node-status":{"type":"object","additionalProperties":false},"limit-count":{"type":"object","properties":{"policy":{"type":"string","enum":["local","redis"],"default":"local"},"count":{"type":"integer","minimum":0},"key":{"type":"string","enum":["remote_addr","server_addr","http_x_real_ip","http_x_forwarded_for"]},"time_window":{"type":"integer","minimum":0},"rejected_code":{"type":"integer","default":503,"maximum":600,"minimum":200}},"dependencies":{"policy":{"oneOf":[{"properties":{"policy":{"enum":["local"]}}},{"required":["redis_host"],"properties":{"policy":{"enum":["redis"]},"redis_port":{"type":"integer","default":6379,"minimum":1},"redis_host":{"type":"string","minLength":2},"redis_timeout":{"type":"integer","default":1000,"minimum":1},"redis_password":{"type":"string","minLength":0}}}]}},"required":["count","time_window","key"]},"response-rewrite":{"type":"object","properties":{"status_code":{"description":"new status code for repsonse","type":"integer","maximum":598,"minimum":200},"headers":{"description":"new headers for repsonse","minProperties":1,"type":"object"},"body":{"description":"new body for repsonse","type":"string"},"body_base64":{"description":"whether new body for repsonse need base64 decode before return","default":false,"type":"boolean"}},"minProperties":1,"additionalProperties":false},"echo":{"type":"object","properties":{"auth_value":{"description":"auth value","type":"string"},"after_body":{"description":"body after the modification of filter phase.","type":"string"},"body":{"description":"body to replace upstream response.","type":"string"},"before_body":{"description":"body before the filter phase.","type":"string"},"headers":{"description":"new headers for response","minProperties":1,"type":"object"}},"anyOf":[{"required":["before_body"]},{"required":["body"]},{"required":["after_body"]}],"minProperties":1,"additionalProperties":false},"key-auth":{"type":"object","properties":{"key":{"type":"string"}}},"redirect":{"type":"object","properties":{"ret_code":{"type":"integer","default":302,"minimum":200},"http_to_https":{"type":"boolean"},"uri":{"type":"string","minLength":2}},"oneOf":[{"required":["uri"]},{"required":["http_to_https"]}]},"proxy-mirror":{"type":"object","properties":{"host":{"type":"string","pattern":"^http(s)?:\\/\\/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+(:[0-9]{1,5})?$"}},"minProperties":1,"required":["host"]},"hmac-auth":{"type":"object","oneOf":[{"title":"work with route or service object","properties":[],"additionalProperties":false},{"title":"work with consumer object","properties":{"algorithm":{"type":"string","enum":["hmac-sha1","hmac-sha256","hmac-sha512"],"default":"hmac-sha256"},"secret_key":{"type":"string","maxLength":256,"minLength":1},"signed_headers":{"type":"array","items":{"type":"string","maxLength":50,"minLength":1}},"access_key":{"type":"string","maxLength":256,"minLength":1},"clock_skew":{"type":"integer","default":0}},"additionalProperties":false,"required":["access_key","secret_key"]}]},"log-rotate":{"type":"object","properties":[],"additionalProperties":false},"limit-conn":{"type":"object","properties":{"burst":{"type":"integer","minimum":0},"key":{"type":"string","enum":["remote_addr","server_addr","http_x_real_ip","http_x_forwarded_for"]},"rejected_code":{"type":"integer","default":503,"minimum":200},"default_conn_delay":{"type":"number","minimum":0},"conn":{"type":"integer","minimum":0}},"required":["conn","burst","default_conn_delay","key"]},"proxy-cache":{"type":"object","properties":{"hide_cache_headers":{"type":"boolean","default":false},"no_cache":{"type":"array","items":{"type":"string","pattern":"(^[^\\$].+$|^\\$[0-9a-zA-Z_]+$)"},"minItems":1},"cache_key":{"type":"array","default":["$host","$request_uri"],"items":{"description":"a key for caching","pattern":"(^[^\\$].+$|^\\$[0-9a-zA-Z_]+$)","type":"string"},"minItems":1},"cache_method":{"type":"array","uniqueItems":true,"default":["GET","HEAD"],"items":{"description":"http method","enum":["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS","CONNECT","TRACE"],"type":"string"},"minItems":1},"cache_bypass":{"type":"array","items":{"type":"string","pattern":"(^[^\\$].+$|^\\$[0-9a-zA-Z_]+$)"},"minItems":1},"cache_zone":{"type":"string","minLength":1},"cache_http_status":{"type":"array","uniqueItems":true,"default":[200,301,404],"items":{"description":"http response status","type":"integer","maximum":599,"minimum":200},"minItems":1}},"required":["cache_zone"]},"limit-req":{"type":"object","properties":{"key":{"type":"string","enum":["remote_addr","server_addr","http_x_real_ip","http_x_forwarded_for"]},"rejected_code":{"type":"integer","default":503,"minimum":200},"rate":{"type":"number","minimum":0},"burst":{"type":"number","minimum":0}},"required":["rate","burst","key"]},"jwt-auth":{"type":"object","properties":{"base64_secret":{"type":"boolean","default":false},"algorithm":{"type":"string","enum":["HS256","HS384","HS512","RS256","ES256"]},"key":{"type":"string"},"exp":{"type":"integer","minimum":1},"secret":{"type":"string"}}},"consumer-restriction":{"type":"object","properties":{"type":{"type":"string","enum":["consumer_name","service_id"],"default":"consumer_name"},"blacklist":{"type":"array","items":{"type":"string"},"minItems":1},"whitelist":{"type":"array","items":{"type":"string"},"minItems":1},"rejected_code":{"type":"integer","default":403,"minimum":200}},"oneOf":[{"required":["whitelist"]},{"required":["blacklist"]}]}},"main":{"host_def":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"},"ip_def":[{"title":"IPv4","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}$","type":"string"},{"title":"IPv4/CIDR","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/[0-9]{1,2}$","type":"string"},{"title":"IPv6","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?$","type":"string"},{"title":"IPv6/CIDR","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?/[0-9]{1,3}$","type":"string"}],"ssl":{"type":"object","properties":{"validity_end":{"type":"integer"},"key":{"type":"string","maxLength":65536,"minLength":128},"validity_start":{"type":"integer"},"exptime":{"type":"integer","minimum":1588262400},"cert":{"type":"string","maxLength":65536,"minLength":128},"sni":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"},"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"status":{"description":"ssl status, 1 to enable, 0 to disable","enum":[1,0],"default":1,"type":"integer"},"create_time":{"type":"integer"},"update_time":{"type":"integer"},"certs":{"type":"array","items":{"type":"string","maxLength":65536,"minLength":128}},"keys":{"type":"array","items":{"type":"string","maxLength":65536,"minLength":128}},"snis":{"type":"array","items":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}}},"additionalProperties":false,"oneOf":[{"required":["sni","key","cert"]},{"required":["snis","key","cert"]}]},"upstream_hash_header_schema":{"type":"string","pattern":"^[a-zA-Z0-9-_]+$"},"plugin_disable_schema":{"disable":{"type":"boolean"}},"upstream_hash_vars_schema":{"type":"string","pattern":"^((uri|server_name|server_addr|request_uri|remote_port|remote_addr|query_string|host|hostname)|arg_[0-9a-zA-z_-]+)$"},"version":0.5,"id_schema":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"consumer":{"type":"object","properties":{"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"username":{"type":"string","maxLength":32,"pattern":"^[a-zA-Z0-9_]+$","minLength":1},"update_time":{"type":"integer"},"desc":{"type":"string","maxLength":256},"create_time":{"type":"integer"},"plugins":{"type":"object"}},"additionalProperties":false,"required":["username"]},"proto":{"type":"object","properties":{"content":{"type":"string","maxLength":1048576,"minLength":1}},"additionalProperties":false,"required":["content"]},"stream_route":{"type":"object","properties":{"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"upstream":{"type":"object","properties":{"type":{"description":"algorithms of load balancing","enum":["chash","roundrobin","ewma"],"type":"string"},"nodes":{"anyOf":[{"type":"object","minProperties":1,"patternProperties":{".*":{"description":"weight of node","type":"integer","minimum":0}}},{"type":"array","items":{"type":"object","properties":{"weight":{"description":"weight of node","type":"integer","minimum":0},"port":{"description":"port of node","type":"integer","minimum":1},"metadata":{"description":"metadata of node","type":"object"},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}},"required":["host","port","weight"]},"minItems":1}]},"k8s_deployment_info":{"type":"object","properties":{"service_name":{"type":"string","description":"k8s service name"},"deploy_name":{"type":"string","description":"k8s deployment name"},"backend_type":{"type":"string","default":"pod","enum":["svc","pod"],"description":"k8s service name"},"namespace":{"type":"string","description":"k8s namespace"},"port":{"type":"number","minimum":0}},"anyOf":[{"required":["namespace","deploy_name","port"]},{"required":["namespace","service_name","port"]}]},"timeout":{"type":"object","properties":{"send":{"type":"number","minimum":0},"connect":{"type":"number","minimum":0},"read":{"type":"number","minimum":0}},"required":["connect","send","read"]},"upstream_host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"},"enable_websocket":{"description":"enable websocket for request","type":"boolean"},"desc":{"type":"string","maxLength":256},"name":{"type":"string","maxLength":50},"key":{"description":"the key of chash for dynamic load balancing","type":"string"},"service_name":{"type":"string","maxLength":50},"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"pass_host":{"description":"mod of host passing","enum":["pass","node","rewrite"],"default":"pass","type":"string"},"update_time":{"type":"integer"},"checks":{"type":"object","properties":{"passive":{"type":"object","properties":{"type":{"type":"string","enum":["http","https","tcp"],"default":"http"},"healthy":{"type":"object","properties":{"http_statuses":{"type":"array","uniqueItems":true,"default":[200,201,202,203,204,205,206,207,208,226,300,301,302,303,304,305,306,307,308],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"successes":{"type":"integer","default":5,"maximum":254,"minimum":1}}},"unhealthy":{"type":"object","properties":{"tcp_failures":{"type":"integer","default":2,"maximum":254,"minimum":1},"timeouts":{"type":"integer","default":7,"maximum":254,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[429,500,503],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"http_failures":{"type":"integer","default":5,"maximum":254,"minimum":1}}}}},"active":{"type":"object","properties":{"type":{"type":"string","enum":["http","https","tcp"],"default":"http"},"port":{"type":"integer","maximum":65535,"minimum":1},"req_headers":{"type":"array","items":{"type":"string","uniqueItems":true},"minItems":1},"https_verify_certificate":{"type":"boolean","default":true},"unhealthy":{"type":"object","properties":{"tcp_failures":{"type":"integer","default":2,"maximum":254,"minimum":1},"interval":{"type":"integer","default":0,"minimum":1},"timeouts":{"type":"integer","default":3,"maximum":254,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[429,404,500,501,502,503,504,505],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"http_failures":{"type":"integer","default":5,"maximum":254,"minimum":1}}},"timeout":{"type":"number","default":1},"http_path":{"type":"string","default":"/"},"healthy":{"type":"object","properties":{"interval":{"type":"integer","default":0,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[200,302],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"successes":{"type":"integer","default":2,"maximum":254,"minimum":1}}},"concurrency":{"type":"integer","default":10},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}}}},"additionalProperties":false,"anyOf":[{"required":["active"]},{"required":["active","passive"]}]},"hash_on":{"type":"string","default":"vars","enum":["vars","header","cookie","consumer"]},"create_time":{"type":"integer"},"retries":{"type":"integer","minimum":0}},"additionalProperties":false,"anyOf":[{"required":["type","nodes"]},{"required":["type","k8s_deployment_info"]},{"required":["type","service_name"]}]},"upstream_id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"remote_addr":{"description":"client IP","anyOf":[{"title":"IPv4","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}$","type":"string"},{"title":"IPv4/CIDR","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/[0-9]{1,2}$","type":"string"},{"title":"IPv6","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?$","type":"string"},{"title":"IPv6/CIDR","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?/[0-9]{1,3}$","type":"string"}],"type":"string"},"server_addr":{"description":"server IP","anyOf":[{"title":"IPv4","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}$","type":"string"},{"title":"IPv4/CIDR","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/[0-9]{1,2}$","type":"string"},{"title":"IPv6","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?$","type":"string"},{"title":"IPv6/CIDR","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?/[0-9]{1,3}$","type":"string"}],"type":"string"},"server_port":{"description":"server port","type":"integer"},"plugins":{"type":"object"}}},"service":{"type":"object","properties":{"name":{"type":"string","maxLength":50},"upstream_id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"script":{"type":"string","maxLength":102400,"minLength":10},"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"create_time":{"type":"integer"},"update_time":{"type":"integer"},"desc":{"type":"string","maxLength":256},"upstream":{"type":"object","properties":{"type":{"description":"algorithms of load balancing","enum":["chash","roundrobin","ewma"],"type":"string"},"nodes":{"anyOf":[{"type":"object","minProperties":1,"patternProperties":{".*":{"description":"weight of node","type":"integer","minimum":0}}},{"type":"array","items":{"type":"object","properties":{"weight":{"description":"weight of node","type":"integer","minimum":0},"port":{"description":"port of node","type":"integer","minimum":1},"metadata":{"description":"metadata of node","type":"object"},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}},"required":["host","port","weight"]},"minItems":1}]},"k8s_deployment_info":{"type":"object","properties":{"service_name":{"type":"string","description":"k8s service name"},"deploy_name":{"type":"string","description":"k8s deployment name"},"backend_type":{"type":"string","default":"pod","enum":["svc","pod"],"description":"k8s service name"},"namespace":{"type":"string","description":"k8s namespace"},"port":{"type":"number","minimum":0}},"anyOf":[{"required":["namespace","deploy_name","port"]},{"required":["namespace","service_name","port"]}]},"timeout":{"type":"object","properties":{"send":{"type":"number","minimum":0},"connect":{"type":"number","minimum":0},"read":{"type":"number","minimum":0}},"required":["connect","send","read"]},"upstream_host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"},"enable_websocket":{"description":"enable websocket for request","type":"boolean"},"desc":{"type":"string","maxLength":256},"name":{"type":"string","maxLength":50},"key":{"description":"the key of chash for dynamic load balancing","type":"string"},"service_name":{"type":"string","maxLength":50},"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"pass_host":{"description":"mod of host passing","enum":["pass","node","rewrite"],"default":"pass","type":"string"},"update_time":{"type":"integer"},"checks":{"type":"object","properties":{"passive":{"type":"object","properties":{"type":{"type":"string","enum":["http","https","tcp"],"default":"http"},"healthy":{"type":"object","properties":{"http_statuses":{"type":"array","uniqueItems":true,"default":[200,201,202,203,204,205,206,207,208,226,300,301,302,303,304,305,306,307,308],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"successes":{"type":"integer","default":5,"maximum":254,"minimum":1}}},"unhealthy":{"type":"object","properties":{"tcp_failures":{"type":"integer","default":2,"maximum":254,"minimum":1},"timeouts":{"type":"integer","default":7,"maximum":254,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[429,500,503],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"http_failures":{"type":"integer","default":5,"maximum":254,"minimum":1}}}}},"active":{"type":"object","properties":{"type":{"type":"string","enum":["http","https","tcp"],"default":"http"},"port":{"type":"integer","maximum":65535,"minimum":1},"req_headers":{"type":"array","items":{"type":"string","uniqueItems":true},"minItems":1},"https_verify_certificate":{"type":"boolean","default":true},"unhealthy":{"type":"object","properties":{"tcp_failures":{"type":"integer","default":2,"maximum":254,"minimum":1},"interval":{"type":"integer","default":0,"minimum":1},"timeouts":{"type":"integer","default":3,"maximum":254,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[429,404,500,501,502,503,504,505],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"http_failures":{"type":"integer","default":5,"maximum":254,"minimum":1}}},"timeout":{"type":"number","default":1},"http_path":{"type":"string","default":"/"},"healthy":{"type":"object","properties":{"interval":{"type":"integer","default":0,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[200,302],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"successes":{"type":"integer","default":2,"maximum":254,"minimum":1}}},"concurrency":{"type":"integer","default":10},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}}}},"additionalProperties":false,"anyOf":[{"required":["active"]},{"required":["active","passive"]}]},"hash_on":{"type":"string","default":"vars","enum":["vars","header","cookie","consumer"]},"create_time":{"type":"integer"},"retries":{"type":"integer","minimum":0}},"additionalProperties":false,"anyOf":[{"required":["type","nodes"]},{"required":["type","k8s_deployment_info"]},{"required":["type","service_name"]}]},"plugins":{"type":"object"}},"additionalProperties":false},"route":{"type":"object","properties":{"hosts":{"type":"array","uniqueItems":true,"items":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}},"filter_func":{"type":"string","pattern":"^function","minLength":10},"service_id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"upstream":{"type":"object","properties":{"type":{"description":"algorithms of load balancing","enum":["chash","roundrobin","ewma"],"type":"string"},"nodes":{"anyOf":[{"type":"object","minProperties":1,"patternProperties":{".*":{"description":"weight of node","type":"integer","minimum":0}}},{"type":"array","items":{"type":"object","properties":{"weight":{"description":"weight of node","type":"integer","minimum":0},"port":{"description":"port of node","type":"integer","minimum":1},"metadata":{"description":"metadata of node","type":"object"},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}},"required":["host","port","weight"]},"minItems":1}]},"k8s_deployment_info":{"type":"object","properties":{"service_name":{"type":"string","description":"k8s service name"},"deploy_name":{"type":"string","description":"k8s deployment name"},"backend_type":{"type":"string","default":"pod","enum":["svc","pod"],"description":"k8s service name"},"namespace":{"type":"string","description":"k8s namespace"},"port":{"type":"number","minimum":0}},"anyOf":[{"required":["namespace","deploy_name","port"]},{"required":["namespace","service_name","port"]}]},"timeout":{"type":"object","properties":{"send":{"type":"number","minimum":0},"connect":{"type":"number","minimum":0},"read":{"type":"number","minimum":0}},"required":["connect","send","read"]},"upstream_host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"},"enable_websocket":{"description":"enable websocket for request","type":"boolean"},"desc":{"type":"string","maxLength":256},"name":{"type":"string","maxLength":50},"key":{"description":"the key of chash for dynamic load balancing","type":"string"},"service_name":{"type":"string","maxLength":50},"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"pass_host":{"description":"mod of host passing","enum":["pass","node","rewrite"],"default":"pass","type":"string"},"update_time":{"type":"integer"},"checks":{"type":"object","properties":{"passive":{"type":"object","properties":{"type":{"type":"string","enum":["http","https","tcp"],"default":"http"},"healthy":{"type":"object","properties":{"http_statuses":{"type":"array","uniqueItems":true,"default":[200,201,202,203,204,205,206,207,208,226,300,301,302,303,304,305,306,307,308],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"successes":{"type":"integer","default":5,"maximum":254,"minimum":1}}},"unhealthy":{"type":"object","properties":{"tcp_failures":{"type":"integer","default":2,"maximum":254,"minimum":1},"timeouts":{"type":"integer","default":7,"maximum":254,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[429,500,503],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"http_failures":{"type":"integer","default":5,"maximum":254,"minimum":1}}}}},"active":{"type":"object","properties":{"type":{"type":"string","enum":["http","https","tcp"],"default":"http"},"port":{"type":"integer","maximum":65535,"minimum":1},"req_headers":{"type":"array","items":{"type":"string","uniqueItems":true},"minItems":1},"https_verify_certificate":{"type":"boolean","default":true},"unhealthy":{"type":"object","properties":{"tcp_failures":{"type":"integer","default":2,"maximum":254,"minimum":1},"interval":{"type":"integer","default":0,"minimum":1},"timeouts":{"type":"integer","default":3,"maximum":254,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[429,404,500,501,502,503,504,505],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"http_failures":{"type":"integer","default":5,"maximum":254,"minimum":1}}},"timeout":{"type":"number","default":1},"http_path":{"type":"string","default":"/"},"healthy":{"type":"object","properties":{"interval":{"type":"integer","default":0,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[200,302],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"successes":{"type":"integer","default":2,"maximum":254,"minimum":1}}},"concurrency":{"type":"integer","default":10},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}}}},"additionalProperties":false,"anyOf":[{"required":["active"]},{"required":["active","passive"]}]},"hash_on":{"type":"string","default":"vars","enum":["vars","header","cookie","consumer"]},"create_time":{"type":"integer"},"retries":{"type":"integer","minimum":0}},"additionalProperties":false,"anyOf":[{"required":["type","nodes"]},{"required":["type","k8s_deployment_info"]},{"required":["type","service_name"]}]},"desc":{"type":"string","maxLength":256},"remote_addrs":{"type":"array","uniqueItems":true,"items":{"description":"client IP","anyOf":[{"title":"IPv4","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}$","type":"string"},{"title":"IPv4/CIDR","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/[0-9]{1,2}$","type":"string"},{"title":"IPv6","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?$","type":"string"},{"title":"IPv6/CIDR","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?/[0-9]{1,3}$","type":"string"}],"type":"string"}},"create_time":{"type":"integer"},"vars":{"type":"array","items":{"description":"Nginx builtin variable name and value","items":{"anyOf":[{"type":"string"},{"type":"number"}],"maxItems":3,"minItems":2},"type":"array"}},"name":{"type":"string","maxLength":50},"remote_addr":{"description":"client IP","anyOf":[{"title":"IPv4","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}$","type":"string"},{"title":"IPv4/CIDR","pattern":"^[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/[0-9]{1,2}$","type":"string"},{"title":"IPv6","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?$","type":"string"},{"title":"IPv6/CIDR","pattern":"^([a-fA-F0-9]{0,4}:){0,8}(:[a-fA-F0-9]{0,4}){0,8}([a-fA-F0-9]{0,4})?/[0-9]{1,3}$","type":"string"}],"type":"string"},"upstream_id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"service_protocol":{"enum":["grpc","http"]},"script":{"type":"string","maxLength":102400,"minLength":10},"plugins":{"type":"object"},"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"priority":{"type":"integer","default":0},"uris":{"type":"array","uniqueItems":true,"items":{"description":"HTTP uri","type":"string"}},"update_time":{"type":"integer"},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"},"methods":{"type":"array","uniqueItems":true,"items":{"description":"HTTP method","enum":["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS","CONNECT","TRACE"],"type":"string"}},"uri":{"type":"string","maxLength":4096,"minLength":1}},"not":{"anyOf":[{"required":["script","plugins"]}]},"anyOf":[{"required":["plugins","uri"]},{"required":["upstream","uri"]},{"required":["upstream_id","uri"]},{"required":["service_id","uri"]},{"required":["plugins","uris"]},{"required":["upstream","uris"]},{"required":["upstream_id","uris"]},{"required":["service_id","uris"]},{"required":["script","uri"]},{"required":["script","uris"]}],"additionalProperties":false},"upstream":{"type":"object","properties":{"type":{"description":"algorithms of load balancing","enum":["chash","roundrobin","ewma"],"type":"string"},"nodes":{"anyOf":[{"type":"object","minProperties":1,"patternProperties":{".*":{"description":"weight of node","type":"integer","minimum":0}}},{"type":"array","items":{"type":"object","properties":{"weight":{"description":"weight of node","type":"integer","minimum":0},"port":{"description":"port of node","type":"integer","minimum":1},"metadata":{"description":"metadata of node","type":"object"},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}},"required":["host","port","weight"]},"minItems":1}]},"k8s_deployment_info":{"type":"object","properties":{"service_name":{"type":"string","description":"k8s service name"},"deploy_name":{"type":"string","description":"k8s deployment name"},"backend_type":{"type":"string","default":"pod","enum":["svc","pod"],"description":"k8s service name"},"namespace":{"type":"string","description":"k8s namespace"},"port":{"type":"number","minimum":0}},"anyOf":[{"required":["namespace","deploy_name","port"]},{"required":["namespace","service_name","port"]}]},"timeout":{"type":"object","properties":{"send":{"type":"number","minimum":0},"connect":{"type":"number","minimum":0},"read":{"type":"number","minimum":0}},"required":["connect","send","read"]},"upstream_host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"},"enable_websocket":{"description":"enable websocket for request","type":"boolean"},"desc":{"type":"string","maxLength":256},"name":{"type":"string","maxLength":50},"key":{"description":"the key of chash for dynamic load balancing","type":"string"},"service_name":{"type":"string","maxLength":50},"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]},"pass_host":{"description":"mod of host passing","enum":["pass","node","rewrite"],"default":"pass","type":"string"},"update_time":{"type":"integer"},"checks":{"type":"object","properties":{"passive":{"type":"object","properties":{"type":{"type":"string","enum":["http","https","tcp"],"default":"http"},"healthy":{"type":"object","properties":{"http_statuses":{"type":"array","uniqueItems":true,"default":[200,201,202,203,204,205,206,207,208,226,300,301,302,303,304,305,306,307,308],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"successes":{"type":"integer","default":5,"maximum":254,"minimum":1}}},"unhealthy":{"type":"object","properties":{"tcp_failures":{"type":"integer","default":2,"maximum":254,"minimum":1},"timeouts":{"type":"integer","default":7,"maximum":254,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[429,500,503],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"http_failures":{"type":"integer","default":5,"maximum":254,"minimum":1}}}}},"active":{"type":"object","properties":{"type":{"type":"string","enum":["http","https","tcp"],"default":"http"},"port":{"type":"integer","maximum":65535,"minimum":1},"req_headers":{"type":"array","items":{"type":"string","uniqueItems":true},"minItems":1},"https_verify_certificate":{"type":"boolean","default":true},"unhealthy":{"type":"object","properties":{"tcp_failures":{"type":"integer","default":2,"maximum":254,"minimum":1},"interval":{"type":"integer","default":0,"minimum":1},"timeouts":{"type":"integer","default":3,"maximum":254,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[429,404,500,501,502,503,504,505],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"http_failures":{"type":"integer","default":5,"maximum":254,"minimum":1}}},"timeout":{"type":"number","default":1},"http_path":{"type":"string","default":"/"},"healthy":{"type":"object","properties":{"interval":{"type":"integer","default":0,"minimum":1},"http_statuses":{"type":"array","uniqueItems":true,"default":[200,302],"items":{"type":"integer","maximum":599,"minimum":200},"minItems":1},"successes":{"type":"integer","default":2,"maximum":254,"minimum":1}}},"concurrency":{"type":"integer","default":10},"host":{"type":"string","pattern":"^\\*?[0-9a-zA-Z-.]+$"}}}},"additionalProperties":false,"anyOf":[{"required":["active"]},{"required":["active","passive"]}]},"hash_on":{"type":"string","default":"vars","enum":["vars","header","cookie","consumer"]},"create_time":{"type":"integer"},"retries":{"type":"integer","minimum":0}},"additionalProperties":false,"anyOf":[{"required":["type","nodes"]},{"required":["type","k8s_deployment_info"]},{"required":["type","service_name"]}]},"global_rule":{"type":"object","properties":{"plugins":{"type":"object"},"id":{"anyOf":[{"type":"string","maxLength":64,"pattern":"^[a-zA-Z0-9-_]+$","minLength":1},{"type":"integer","minimum":1}]}},"additionalProperties":false,"required":["plugins"]}}}
